<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>College Student Landing Page</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="flash {{ category }}">{{ message }}</div>
            {% endfor %}
        {% endif %}
    {% endwith %}
    <h1> {{ current_user.first_name }}'s Landing Page</h1>
    <h1> College Student </h1>

    <!-- Form to Add New Item -->
    <h2>Add Item</h2>
    <form id="addItemForm">
        <input type="text" id="name" placeholder="Name" required>
        <input type="text" id="description" placeholder="Description" required>
        <button type="submit">Add Item</button>
    </form>

    <!-- Table to Display Items -->
    {% if items %}
    <h2>Items</h2>
    {% endif %}
    <table id="itemsTable">
        {% if items %}
        <tr>
            <th>Name</th>
            <th>Description</th>
            <th>Actions</th>
        </tr>
        {% endif %}
        {% for item in items %}
        <tr>
            <td>{{ item.name }}</td>
            <td>
                <input type="text" id="desc_{{ item.item_id }}" value="{{ item.description }}">
                <button onclick="updateItem({{ item.item_id }})">Update</button>
            </td>
            <td><button onclick="deleteItem({{ item.item_id }})">Delete</button></td>
        </tr>
        {% endfor %}
    </table>

    <!-- Program Application Management Section -->
    <div>
      <h2>Program Management</h2>
      <a href="{{ url_for('program_application') }}">
        <button>Apply</button>
      </a>
      <a href="{{ url_for('application_review') }}">
        <button>Review Applications</button>
      </a>
      <a>
        <button>Update Applications</button>
      </a>
    </div>

    <!-- Logout Button -->
    <form action="{{ url_for('logout') }}" method="post">
        <button type="submit">Logout</button>
    </form>

    <script>
        //AJAX calls

        // Add item
        $('#addItemForm').submit(function(e) {
            e.preventDefault();
            $.ajax({
                url: '/items/add',
                method: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({ 
                    name: $('#name').val(), 
                    description: $('#description').val() 
                }),
                success: function(response) {
                    window.location.reload(); 
                }
            });
        });

        // Delete item
        function deleteItem(id) {
            $.ajax({
                url: '/items/' + id,
                method: 'DELETE',
                success: function(response) {
                    window.location.reload(); 
                }
            });
        }

        // Update item
        function updateItem(id) {
            $.ajax({
                url: '/items/update/' + id,
                method: 'PUT',
                contentType: 'application/json',
                data: JSON.stringify({ 
                    name: $('#name_' + id).val(), 
                    description: $('#desc_' + id).val()
                }),
                success: function(response) {
                    window.location.reload();
                }
            });
        }
    </script>
</body>
</html>
